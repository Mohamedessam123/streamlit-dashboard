import streamlit as st
import plotly.express as px
import plotly.graph_objects as go
import pandas as pd

# ============================================
# ๐ ุงูุจูุงูุงุช - ุบูุฑ ููุง ููุท ููู ุงูุฑุณููุงุช ูุชุชุญุฏุซ ุชููุงุฆูุงู!
# ============================================

# ุฅุฌูุงููุงุช ุนุงูุฉ
summary = {
    'total_offices': 767,
    'total_transactions': 55485,
    'morning_transactions': 47841,
    'evening_transactions': 8932,
    'digital_transactions': 1265,
    'direct_transactions': 54221
}

# ุชูุฒูุน ุงููุนุงููุงุช ุญุณุจ ุงููุญุงูุธุงุช (ุฃุนูู 15)
governorates_data = [
    {'ุงููุญุงูุธุฉ': 'ุงููุงูุฑุฉ', 'ุงููุนุงููุงุช': 8447, 'ุงููุณุจุฉ': 15},
    {'ุงููุญุงูุธุฉ': 'ุงูุฌูุฒุฉ', 'ุงููุนุงููุงุช': 5986, 'ุงููุณุจุฉ': 11},
    {'ุงููุญุงูุธุฉ': 'ุงูุดุฑููุฉ', 'ุงููุนุงููุงุช': 3763, 'ุงููุณุจุฉ': 7},
    {'ุงููุญุงูุธุฉ': 'ุงูุฏููููุฉ', 'ุงููุนุงููุงุช': 3719, 'ุงููุณุจุฉ': 7},
    {'ุงููุญุงูุธุฉ': 'ุงูุฅุณููุฏุฑูุฉ', 'ุงููุนุงููุงุช': 3715, 'ุงููุณุจุฉ': 7},
    {'ุงููุญุงูุธุฉ': 'ุงูููููุจูุฉ', 'ุงููุนุงููุงุช': 2770, 'ุงููุณุจุฉ': 5},
    {'ุงููุญุงูุธุฉ': 'ุงูุจุญูุฑุฉ', 'ุงููุนุงููุงุช': 2721, 'ุงููุณุจุฉ': 5},
    {'ุงููุญุงูุธุฉ': 'ุงูุบุฑุจูุฉ', 'ุงููุนุงููุงุช': 2580, 'ุงููุณุจุฉ': 5},
    {'ุงููุญุงูุธุฉ': 'ุงููููููุฉ', 'ุงููุนุงููุงุช': 2520, 'ุงููุณุจุฉ': 5},
    {'ุงููุญุงูุธุฉ': 'ุงููููุง', 'ุงููุนุงููุงุช': 2268, 'ุงููุณุจุฉ': 4},
    {'ุงููุญุงูุธุฉ': 'ููุฑ ุงูุดูุฎ', 'ุงููุนุงููุงุช': 2017, 'ุงููุณุจุฉ': 4},
    {'ุงููุญุงูุธุฉ': 'ุณููุงุฌ', 'ุงููุนุงููุงุช': 2004, 'ุงููุณุจุฉ': 4},
    {'ุงููุญุงูุธุฉ': 'ุฃุณููุท', 'ุงููุนุงููุงุช': 1803, 'ุงููุณุจุฉ': 3},
    {'ุงููุญุงูุธุฉ': 'ุจูู ุณููู', 'ุงููุนุงููุงุช': 1586, 'ุงููุณุจุฉ': 3},
    {'ุงููุญุงูุธุฉ': 'ููุง', 'ุงููุนุงููุงุช': 1302, 'ุงููุณุจุฉ': 2}
]

# ูุนุฏู ุงูุฅุตุฏุงุฑ ุญุณุจ ุงูุณุงุนุฉ
hourly_data = [
    {'ุงูุณุงุนุฉ': '8:30-10:00', 'ุงููุนุงููุงุช': 4260},
    {'ุงูุณุงุนุฉ': '10:00-11:00', 'ุงููุนุงููุงุช': 7312},
    {'ุงูุณุงุนุฉ': '11:00-12:00', 'ุงููุนุงููุงุช': 7731},
    {'ุงูุณุงุนุฉ': '12:00-13:00', 'ุงููุนุงููุงุช': 7325},
    {'ุงูุณุงุนุฉ': '13:00-14:00', 'ุงููุนุงููุงุช': 5860},
    {'ุงูุณุงุนุฉ': '14:00-17:00', 'ุงููุนุงููุงุช': 6414},
    {'ุงูุณุงุนุฉ': 'ูุณุงุฆู', 'ุงููุนุงููุงุช': 9439}
]

# ุฃุนูู ุงูููุงุชุจ ุฅุตุฏุงุฑุงู
top_offices_data = [
    {'ุงูููุชุจ': 'ููุชุจ ุชูุซูู ุงูุงูุฑุงู', 'ุตุจุงุญู': 485, 'ูุณุงุฆู': 370, 'ุงูุฅุฌูุงูู': 615},
    {'ุงูููุชุจ': 'ุงูุฎุงููุฉ', 'ุตุจุงุญู': 398, 'ูุณุงุฆู': 213, 'ุงูุฅุฌูุงูู': 398},
    {'ุงูููุชุจ': 'ุงูุฌูุฒุฉ', 'ุตุจุงุญู': 393, 'ูุณุงุฆู': 140, 'ุงูุฅุฌูุงูู': 393},
    {'ุงูููุชุจ': 'ุญููุงู ุงููุทูุฑ', 'ุตุจุงุญู': 346, 'ูุณุงุฆู': 174, 'ุงูุฅุฌูุงูู': 348},
    {'ุงูููุชุจ': 'ุดุจุฑุง ุงูุฎููุฉ', 'ุตุจุงุญู': 338, 'ูุณุงุฆู': 99, 'ุงูุฅุฌูุงูู': 338},
    {'ุงูููุชุจ': 'ุงูุณุงุฏุงุช', 'ุตุจุงุญู': 331, 'ูุณุงุฆู': 162, 'ุงูุฅุฌูุงูู': 331},
    {'ุงูููุชุจ': 'ุงูุนุงุดุฑ ูู ุฑูุถุงู', 'ุตุจุงุญู': 308, 'ูุณุงุฆู': 123, 'ุงูุฅุฌูุงูู': 308},
    {'ุงูููุชุจ': 'ุจูู ุณููู', 'ุตุจุงุญู': 287, 'ูุณุงุฆู': 101, 'ุงูุฅุฌูุงูู': 287},
    {'ุงูููุชุจ': 'ููุฑ ุงูุฏูุงุฑ', 'ุตุจุงุญู': 281, 'ูุณุงุฆู': 94, 'ุงูุฅุฌูุงูู': 281},
    {'ุงูููุชุจ': 'ุงูุบุฑุฏูุฉ', 'ุตุจุงุญู': 280, 'ูุณุงุฆู': 84, 'ุงูุฅุฌูุงูู': 280}
]

# ============================================
# ุฅุนุฏุงุฏ ุงูุตูุญุฉ
# ============================================

st.set_page_config(
    page_title="ููุญุฉ ุชุญููู ููุงุชุจ ุงูุชูุซูู",
    page_icon="๐",
    layout="wide",
    initial_sidebar_state="expanded"
)

# CSS ูุชุญุณูู ุงููุธูุฑ
st.markdown("""
<style>
    .stMetric {
        background-color: #f0f2f6;
        padding: 15px;
        border-radius: 10px;
    }
    h1, h2, h3 {
        text-align: right;
    }
</style>
""", unsafe_allow_html=True)

# ============================================
# ุงูุนููุงู ุงูุฑุฆูุณู
# ============================================

st.title("๐ ููุญุฉ ุชุญููู ููุงุชุจ ุงูุชูุซูู")
st.markdown("### ููู ุงูุซูุงุซุงุก 30-09-2025")
st.divider()

# ============================================
# ุงูุจุทุงูุงุช ุงูุฅุญุตุงุฆูุฉ
# ============================================

col1, col2, col3, col4 = st.columns(4)

with col1:
    st.metric(
        label="๐ข ุฅุฌูุงูู ุงูููุงุชุจ",
        value=f"{summary['total_offices']:,}"
    )

with col2:
    st.metric(
        label="๐ ุฅุฌูุงูู ุงููุนุงููุงุช",
        value=f"{summary['total_transactions']:,}"
    )

with col3:
    st.metric(
        label="๐ ูุนุงููุงุช ุตุจุงุญูุฉ",
        value=f"{summary['morning_transactions']:,}"
    )

with col4:
    st.metric(
        label="๐ ูุนุงููุงุช ูุณุงุฆูุฉ",
        value=f"{summary['evening_transactions']:,}"
    )

st.divider()

# ============================================
# ุงูุชุจููุจุงุช
# ============================================

tab1, tab2, tab3, tab4 = st.tabs([
    "ูุธุฑุฉ ุนุงูุฉ",
    "ุชูุฒูุน ุงููุญุงูุธุงุช", 
    "ุงูุฃุฏุงุก ุงูุฒููู",
    "ุฃุนูู ุงูููุงุชุจ"
])

# ============================================
# ุชุจููุจ 1: ูุธุฑุฉ ุนุงูุฉ
# ============================================

with tab1:
    col1, col2 = st.columns(2)
    
    # ูุตุฑ ุงูุฑูููุฉ vs ุงููุจุงุดุฑ
    with col1:
        st.subheader("ูุตุฑ ุงูุฑูููุฉ vs ุงููุจุงุดุฑ")
        
        digital_direct_df = pd.DataFrame({
            'ุงูููุน': ['ูุตุฑ ุงูุฑูููุฉ', 'ูุจุงุดุฑ ูู ุงูููุชุจ'],
            'ุงูุนุฏุฏ': [summary['digital_transactions'], summary['direct_transactions']]
        })
        
        fig1 = px.pie(
            digital_direct_df,
            values='ุงูุนุฏุฏ',
            names='ุงูููุน',
            color_discrete_sequence=['#10b981', '#3b82f6'],
            hole=0.4
        )
        fig1.update_traces(
            textposition='inside',
            textinfo='percent+label',
            textfont_size=14
        )
        fig1.update_layout(
            height=400,
            showlegend=True,
            legend=dict(orientation="h", yanchor="bottom", y=-0.2)
        )
        st.plotly_chart(fig1, use_container_width=True)
        
        # ุนุฑุถ ุงูุฃุฑูุงู
        st.metric("ูุตุฑ ุงูุฑูููุฉ", f"{summary['digital_transactions']:,}")
        st.metric("ูุจุงุดุฑ ูู ุงูููุชุจ", f"{summary['direct_transactions']:,}")
    
    # ุตุจุงุญู vs ูุณุงุฆู
    with col2:
        st.subheader("ุงููุชุฑุฉ ุงูุตุจุงุญูุฉ vs ุงููุณุงุฆูุฉ")
        
        period_df = pd.DataFrame({
            'ุงููุชุฑุฉ': ['ุตุจุงุญู', 'ูุณุงุฆู'],
            'ุงูุนุฏุฏ': [summary['morning_transactions'], summary['evening_transactions']]
        })
        
        fig2 = px.pie(
            period_df,
            values='ุงูุนุฏุฏ',
            names='ุงููุชุฑุฉ',
            color_discrete_sequence=['#f59e0b', '#8b5cf6'],
            hole=0.4
        )
        fig2.update_traces(
            textposition='inside',
            textinfo='percent+label',
            textfont_size=14
        )
        fig2.update_layout(
            height=400,
            showlegend=True,
            legend=dict(orientation="h", yanchor="bottom", y=-0.2)
        )
        st.plotly_chart(fig2, use_container_width=True)
        
        # ุนุฑุถ ุงูุฃุฑูุงู
        st.metric("ุตุจุงุญู", f"{summary['morning_transactions']:,}")
        st.metric("ูุณุงุฆู", f"{summary['evening_transactions']:,}")

# ============================================
# ุชุจููุจ 2: ุงููุญุงูุธุงุช
# ============================================

with tab2:
    st.subheader("ุฃุนูู 15 ูุญุงูุธุฉ ูู ุงูุฅุตุฏุงุฑ")
    
    gov_df = pd.DataFrame(governorates_data)
    
    fig3 = px.bar(
        gov_df,
        y='ุงููุญุงูุธุฉ',
        x='ุงููุนุงููุงุช',
        orientation='h',
        color='ุงููุนุงููุงุช',
        color_continuous_scale='Blues',
        text='ุงููุนุงููุงุช'
    )
    fig3.update_traces(
        texttemplate='%{text:,}',
        textposition='outside'
    )
    fig3.update_layout(
        height=600,
        showlegend=False,
        yaxis={'categoryorder':'total ascending'}
    )
    st.plotly_chart(fig3, use_container_width=True)
    
    # ุนุฑุถ ุงูุฌุฏูู
    st.dataframe(
        gov_df.style.format({'ุงููุนุงููุงุช': '{:,}', 'ุงููุณุจุฉ': '{}%'}),
        use_container_width=True,
        hide_index=True
    )

# ============================================
# ุชุจููุจ 3: ุงูุฃุฏุงุก ุงูุฒููู
# ============================================

with tab3:
    st.subheader("ูุนุฏู ุงูุฅุตุฏุงุฑ ุฎูุงู ุณุงุนุงุช ุงูููู")
    
    hourly_df = pd.DataFrame(hourly_data)
    
    fig4 = px.line(
        hourly_df,
        x='ุงูุณุงุนุฉ',
        y='ุงููุนุงููุงุช',
        markers=True,
        line_shape='spline'
    )
    fig4.update_traces(
        line_color='#10b981',
        line_width=3,
        marker=dict(size=10, color='#10b981')
    )
    fig4.update_layout(
        height=500,
        hovermode='x unified'
    )
    st.plotly_chart(fig4, use_container_width=True)
    
    # ุนุฑุถ ุงูุฌุฏูู
    st.dataframe(
        hourly_df.style.format({'ุงููุนุงููุงุช': '{:,}'}),
        use_container_width=True,
        hide_index=True
    )

# ============================================
# ุชุจููุจ 4: ุฃุนูู ุงูููุงุชุจ
# ============================================

with tab4:
    st.subheader("ุฃุนูู 10 ููุงุชุจ ุฅุตุฏุงุฑุงู")
    
    offices_df = pd.DataFrame(top_offices_data)
    
    fig5 = go.Figure()
    
    fig5.add_trace(go.Bar(
        y=offices_df['ุงูููุชุจ'],
        x=offices_df['ุตุจุงุญู'],
        name='ุตุจุงุญู',
        orientation='h',
        marker=dict(color='#f59e0b')
    ))
    
    fig5.add_trace(go.Bar(
        y=offices_df['ุงูููุชุจ'],
        x=offices_df['ูุณุงุฆู'],
        name='ูุณุงุฆู',
        orientation='h',
        marker=dict(color='#8b5cf6')
    ))
    
    fig5.update_layout(
        barmode='stack',
        height=500,
        yaxis={'categoryorder':'total ascending'},
        legend=dict(orientation="h", yanchor="bottom", y=-0.2)
    )
    
    st.plotly_chart(fig5, use_container_width=True)
    
    # ุนุฑุถ ุงูุฌุฏูู
    st.dataframe(
        offices_df.style.format({'ุตุจุงุญู': '{:,}', 'ูุณุงุฆู': '{:,}', 'ุงูุฅุฌูุงูู': '{:,}'}),
        use_container_width=True,
        hide_index=True
    )

# ============================================
# Footer
# ============================================

st.divider()
st.markdown("""
<div style='text-align: center; color: #666; padding: 20px;'>
    <p>ุชู ุฅูุดุงุก ูุฐู ุงูููุญุฉ ุจุงุณุชุฎุฏุงู Streamlit</p>
    <p>ูุชุญุฏูุซ ุงูุจูุงูุงุชุ ูู ุจุชุนุฏูู ุงููุชุบูุฑุงุช ูู ุฃูู ุงูููุฏ</p>
</div>
""", unsafe_allow_html=True)